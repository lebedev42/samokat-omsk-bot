"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const grammy_1 = require("grammy");
const query_string_1 = __importDefault(require("query-string"));
const qs_1 = __importDefault(require("qs"));
const got_1 = __importDefault(require("got"));
const jsdom_1 = require("jsdom");
// https://lk.platformaofd.ru/web/noauth/cheque/id?id=102537638726&date=1700750969000&fp=3182612905
// https://lk.platformaofd.ru/web/noauth/cheque/id?id=102537638726&date=1700750969000&fp=3182612905
const constants_1 = require("../constants");
const magicButton = (keyboard, ctx) => {
    return new keyboard().webApp(constants_1.MENU_TABLE, `${constants_1.APP_BASE_URL}index.html?user=${ctx.update.message.from.id}`);
};
const composer = new grammy_1.Composer();
composer.command("table", async (ctx) => {
    const keyboard = magicButton(grammy_1.InlineKeyboard, ctx);
    await ctx.reply(constants_1.MENU_TABLE, {
        reply_markup: keyboard
    });
});
composer.command("start", async (ctx) => {
    const keyboards = new grammy_1.Keyboard()
        .text(constants_1.MENU_RULES)
        .row()
        .text(constants_1.MENU_SEND)
        .row()
        .webApp(constants_1.MENU_TABLE, `${constants_1.APP_BASE_URL}index.html?user=${ctx.update.message.from.id}`)
        .resized();
    const user = await getPlayer(ctx.update.message.from.id);
    if (!user?.id) {
        await createPlayer(ctx.update.message.from);
        ctx.replyWithPhoto(`${constants_1.S3_BASE_URL}/sm-hello.png`, {
            caption: constants_1.HELLO_RESPONSE_1
        });
    }
    else {
        ctx.reply("Вы уже зарегистрированы");
    }
    await ctx.reply(constants_1.HELLO_RESPONSE_2, {
        reply_markup: keyboards
    });
});
composer.hears(constants_1.MENU_RULES, async (ctx) => {
    const stp1 = grammy_1.InputMediaBuilder.photo(`${constants_1.S3_BASE_URL}/stp-1.jpg`);
    const stp2 = grammy_1.InputMediaBuilder.photo(`${constants_1.S3_BASE_URL}/stp-2.jpg`);
    const stp3 = grammy_1.InputMediaBuilder.photo(`${constants_1.S3_BASE_URL}/stp-3.jpg`);
    const stp4 = grammy_1.InputMediaBuilder.photo(`${constants_1.S3_BASE_URL}/stp-4.jpg`);
    const stp5 = grammy_1.InputMediaBuilder.photo(`${constants_1.S3_BASE_URL}/stp-5.jpg`);
    const stp6 = grammy_1.InputMediaBuilder.photo(`${constants_1.S3_BASE_URL}/stp-6.jpg`);
    const stp7 = grammy_1.InputMediaBuilder.photo(`${constants_1.S3_BASE_URL}/stp-7.jpg`);
    ctx.reply(constants_1.MENU_RULES_RESPONSE_1);
    ctx.replyWithMediaGroup([stp1, stp2, stp3, stp4, stp5, stp6, stp7]);
    ctx.reply(`${constants_1.MENU_RULES_RESPONSE_2} ${constants_1.RULES_TEXT_LINK}`, {
        parse_mode: "HTML",
        disable_web_page_preview: true
    });
});
composer.hears(constants_1.MENU_SEND, async (ctx) => {
    ctx.reply("Начнем соревнования! Отправьте сюда ваш чек из приложения");
});
// получение ссылки на чек
composer.on("message:text", async (ctx) => {
    if (ctx.msg.text.includes(constants_1.OFD_URL)) {
        try {
            const url = new URL(ctx.msg.text);
            const parsedData = query_string_1.default.parse(url.search);
            if (isOFD(parsedData, constants_1.OFD_URL_FIELDS) &&
                typeof parsedData.date === "string") {
                if (parseInt(parsedData.date) > constants_1.GAME_START_TIME) {
                    const checkSum = await parseCheckURL(url.href);
                    await saveTransaction(parsedData, checkSum, ctx);
                    sendConfirmMessage(ctx);
                    await savePlayerPoints(checkSum, ctx);
                    sendSuccessMessage(ctx);
                }
                else {
                    throw new Error();
                }
            }
            else {
                throw new Error();
            }
        }
        catch (error) {
            sendFileCommonErrorMessage(ctx);
            return false;
        }
    }
    else {
        sendFileCommonErrorMessage(ctx);
    }
});
function isOFD(params, check) {
    const paramsFields = new Set(Object.keys(params));
    return check.filter((i) => paramsFields.has(i)).length === check.length;
}
async function sendFileCommonErrorMessage(ctx) {
    ctx.replyWithPhoto(`${constants_1.S3_BASE_URL}/sm-error.png`, {
        caption: constants_1.ERROR_TEXT,
        parse_mode: "HTML",
        disable_web_page_preview: true
    });
}
async function sendConfirmMessage(ctx) {
    ctx.replyWithPhoto(`${constants_1.S3_BASE_URL}/sm-success.png`, {
        caption: constants_1.SUCCESS_1_TEXT
    });
}
async function sendSuccessMessage(ctx) {
    ctx.reply(constants_1.SUCCESS_2_TEXT);
}
async function parseCheckURL(url) {
    return (0, got_1.default)(url)
        .then((response) => {
        const { document } = new jsdom_1.JSDOM(response.body).window;
        const textContent = document
            .getElementById("fido_cheque_container")
            .textContent.replace(/\s+/g, "");
        const isSamokat = textContent.includes("www.samokat.ru");
        if (!isSamokat) {
            throw new Error();
        }
        const match = textContent.match(/(<b>=<span>([]*.*)<\/span><\/b>)/gi);
        const el = document.createElement("div");
        el.innerHTML = match[0];
        const checkSum = el.children[0].textContent.slice(1);
        return parseInt(checkSum);
    })
        .catch((err) => {
        throw new Error();
    });
}
async function getPlayer(id) {
    const query = qs_1.default.stringify({
        filters: {
            ["tgId"]: {
                $eq: id
            }
        }
    });
    return fetch(`${constants_1.API_BASE_URL}api/players?${query}`, {
        method: "get",
        headers: {
            "Content-Type": "application/json",
            Authorization: constants_1.API_AUTH_TOKEN
        }
    })
        .then((res) => res.json())
        .then((data) => {
        if (!Array.isArray(data.data) && data?.error) {
            throw new Error("FIND PLAYER ERROR");
        }
        return data.data[0];
    })
        .catch(() => {
        throw new Error("FIND PLAYER ERROR");
    });
}
async function createPlayer(data) {
    const player = {
        name: data.username,
        firstName: data.first_name,
        lastName: data.last_name,
        tgId: data.id.toString()
    };
    return fetch(`${constants_1.API_BASE_URL}api/players`, {
        method: "post",
        headers: {
            "Content-Type": "application/json",
            Authorization: constants_1.API_AUTH_TOKEN
        },
        body: JSON.stringify({ data: { ...player } })
    }).catch(() => {
        throw new Error("CREATE PLAYER ERROR");
    });
}
async function saveTransaction(data, checkSum, ctx) {
    const user = await getPlayer(ctx.update.message.from.id);
    if (!user?.id) {
        return false;
    }
    const transaction = {
        ofd_url: ctx.update.message.text,
        ofd_date: data.date,
        ofd_id: data.id,
        ofd_fp: data.fp,
        sum: checkSum,
        player: user.id
    };
    return fetch(`${constants_1.API_BASE_URL}api/transactions`, {
        method: "post",
        headers: {
            "Content-Type": "application/json",
            Authorization: constants_1.API_AUTH_TOKEN
        },
        body: JSON.stringify({ data: { ...transaction } })
    })
        .then((res) => res.json())
        .then((data) => {
        if (!Array.isArray(data) && data?.error) {
            throw new Error("CREATE TRANSACTION ERROR");
        }
        return data.data[0];
    })
        .catch((error) => {
        throw new Error("CREATE TRANSACTION ERROR");
    });
}
async function savePlayerPoints(checkSum, ctx) {
    const user = await getPlayer(ctx.update.message.from.id);
    if (!user?.id) {
        return false;
    }
    const newPoints = user.attributes.points + (checkSum / 600).toFixed(2);
    const updatedData = {
        points: newPoints
    };
    return fetch(`${constants_1.API_BASE_URL}api/players/${user.id}`, {
        method: "put",
        headers: {
            "Content-Type": "application/json",
            Authorization: constants_1.API_AUTH_TOKEN
        },
        body: JSON.stringify({ data: { ...updatedData } })
    })
        .then((res) => res.json())
        .then((data) => {
        console.error("data", data);
        if (!Array.isArray(data) && data?.error) {
            throw new Error("SAVE PLAYER POINTS ERROR");
        }
    })
        .catch((error) => {
        throw new Error("SAVE PLAYER POINTS ERROR");
    });
}
exports.default = composer;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbWFuZHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvYm90L2hhbmRsZXJzL2NvbW1hbmRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsbUNBQStFO0FBRy9FLGdFQUF1QztBQUV2Qyw0Q0FBb0I7QUFDcEIsOENBQXNCO0FBQ3RCLGlDQUE4QjtBQUU5QixtR0FBbUc7QUFDbkcsbUdBQW1HO0FBRW5HLDRDQW1Cc0I7QUFFdEIsTUFBTSxXQUFXLEdBQUcsQ0FBQyxRQUFhLEVBQUUsR0FBUSxFQUE2QixFQUFFO0lBQ3pFLE9BQU8sSUFBSSxRQUFRLEVBQUUsQ0FBQyxNQUFNLENBQzFCLHNCQUFVLEVBQ1YsR0FBRyx3QkFBWSxtQkFBbUIsR0FBRyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUMvRCxDQUFDO0FBQ0osQ0FBQyxDQUFDO0FBRUYsTUFBTSxRQUFRLEdBQUcsSUFBSSxpQkFBUSxFQUFXLENBQUM7QUFFekMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxFQUFFO0lBQ3RDLE1BQU0sUUFBUSxHQUFHLFdBQVcsQ0FBQyx1QkFBYyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBRWxELE1BQU0sR0FBRyxDQUFDLEtBQUssQ0FBQyxzQkFBVSxFQUFFO1FBQzFCLFlBQVksRUFBRSxRQUFRO0tBQ3ZCLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUgsUUFBUSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxFQUFFO0lBQ3RDLE1BQU0sU0FBUyxHQUFHLElBQUksaUJBQVEsRUFBRTtTQUM3QixJQUFJLENBQUMsc0JBQVUsQ0FBQztTQUNoQixHQUFHLEVBQUU7U0FDTCxJQUFJLENBQUMscUJBQVMsQ0FBQztTQUNmLEdBQUcsRUFBRTtTQUNMLE1BQU0sQ0FDTCxzQkFBVSxFQUNWLEdB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